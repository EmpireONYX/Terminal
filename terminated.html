<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TERMINATED</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg"></div>

  <div class="termWrap">
    <div class="termHud">
      <div class="termTop">
        <span class="termDot"></span>
        <span class="termTitle">SECURITY TERMINATION</span>
        <span class="termMini" id="termClock"></span>
      </div>

      <div class="termMid">
        <div class="termBracket left"></div>
        <div class="termCore">
          <div class="termLabel">C-P DESCRIPTION</div>

          <div class="termPanel">
            <div class="termPanelHead" id="termTitle">AUTH REQUEST TERMINATED</div>
            <div class="termPanelBody">
              <div>PRECAUTIONS: ENFORCED</div>
              <div>LOCKDOWN: ACTIVE</div>
              <div>TRACE: ENABLED</div>
              <div class="termWarn" id="termWarn">UNAUTHORIZED ACCESS WILL BE LOGGED</div>
            </div>
          </div>

          <div class="termAction" id="retryBlock">
  <div class="termSub">RETRY AVAILABLE IN</div>
  <div class="termCountdown" id="termCountdown">--</div>
 </div>
</div>
        
        <div class="termBracket right"></div>
      </div>

      <div class="termBottom">
        <span class="termMini">ANALYZE</span>
        <span class="termMini">SIG: 0xA19F</span>
      </div>
    </div>
  </div>

  <script>
  // simple HUD clock
  const clockEl = document.getElementById("termClock");
  setInterval(() => {
    const d = new Date();
    clockEl.textContent = d.toLocaleTimeString();
  }, 250);

  // pull dynamic termination text
  const titleEl = document.getElementById("termTitle");
  const warnEl = document.getElementById("termWarn");
  const retryBlock = document.getElementById("retryBlock");
  const cdEl = document.getElementById("termCountdown");

  const termMode = localStorage.getItem("termMode") || "LOCK";
  const tTitle = localStorage.getItem("termTitle");
  const tWarn  = localStorage.getItem("termWarn");

  if (tTitle) titleEl.textContent = tTitle;
  if (tWarn)  warnEl.textContent  = tWarn;

  if (termMode === "HARD") {
    // No retry, no countdown
    retryBlock.style.display = "none";
  } else {
    // Countdown mode
    function tick() {
      const lockUntil = Number(localStorage.getItem("lockUntil") || "0");
      const leftMs = Math.max(0, lockUntil - Date.now());
      const left = Math.ceil(leftMs / 1000);

      cdEl.textContent = left > 0 ? `${left}s` : "0s";

      if (leftMs <= 0) {
        localStorage.removeItem("lockUntil");
        localStorage.removeItem("termMode");
        localStorage.removeItem("termTitle");
        localStorage.removeItem("termWarn");
        window.location.href = "index.html";
      }
    }
    tick();
    setInterval(tick, 200);
  }
</script>
  <script>
  const ADMIN_CLEAR_CODE = "ARBITER-CLEAR"; // must match index.js
  let adminBuffer = "";

  document.addEventListener("keydown", (e) => {
    if (e.key.length === 1) {
      adminBuffer += e.key.toUpperCase();
      adminBuffer = adminBuffer.slice(-32); // keep buffer short
    }

    if (e.key === "Enter") {
      if (adminBuffer.includes(ADMIN_CLEAR_CODE)) {
        // Clear all termination state
        localStorage.removeItem("termMode");
        localStorage.removeItem("termTitle");
        localStorage.removeItem("termWarn");
        localStorage.removeItem("termReason");
        localStorage.removeItem("lockUntil");

        // Optional: log admin clear
        fetch("https://arbiter-log.damshadow1123.workers.dev", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            event: "ADMIN_CLEAR",
            reason: "TERMINATED_PAGE_OVERRIDE",
            page: location.pathname,
            meta: { ua: navigator.userAgent }
          })
        }).catch(() => {});

        window.location.href = "index.html";
      }

      adminBuffer = "";
    }
  });
</script>
</body>
</html>
